#!/bin/bash
portas-fun(){
unset puertos
declare -A port
local portasVAR=$(lsof -V -i tcp -P -n | grep -v "ESTABLISHED" |grep -v "COMMAND" | grep "LISTEN")
#local portasVAR=$(lsof -V -i tcp -P -n | grep -v "ESTABLISHED" |grep -v "COMMAND" | grep "LISTEN" | grep -v 'systemd-resolve')
local NOREPEAT&&local reQ&&local Port
while read port; do
	reQ=$(echo ${port}|awk '{print $1}')
	Port=$(echo ${port} | awk '{print $9}' | awk -F ":" '{print $2}')
	[[ $(echo -e $NOREPEAT|grep -w "$Port") ]] && continue
	NOREPEAT+="$Port\n"
	case ${reQ} in
		*)name=$(echo $reQ|tr -d '[[:punct:]]'|tr -d '[[:space:]]')&&name1=$(echo $name|tr a-z A-Z)
		[[ -z ${port[$name]} ]] && local port[$name]="\033[1;31m $name1: \033[1;32m"&&port[$name]+="$Port ";;
	esac
	done <<< "${portasVAR}"
k=1
for line in "${port[@]}"; do
		[[ -z "$line" ]] && continue
		let RESTO=k%2
	if [[ $RESTO -eq 0 ]]; then
		puertos+="$line\n"
	else
		puertos+="$line-"
	fi
	let k++
done
echo -e "$puertos"|column -t -s '-'|sed 's/-/â€“/g'
}
